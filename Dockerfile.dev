FROM openjdk:17-jdk-alpine

# Mavenをインストール
RUN apk add --no-cache maven

WORKDIR /app

# 依存関係キャッシュ
COPY app/pom.xml .
RUN mvn dependency:go-offline -B

# ソースをコピー
COPY app/ .

# 開発向け設定
ENV SPRING_DEVTOOLS_RESTART_ENABLED=true
ENV SPRING_DEVTOOLS_LIVERELOAD_ENABLED=true
ENV SPRING_PROFILES_ACTIVE=dev

# Mavenのキャッシュ共有用（ローカルマシンの.m2）
VOLUME ["/root/.m2"]

EXPOSE 8080

# spring-boot:runを直接実行
ENTRYPOINT ["/bin/sh" ,"/usr/bin/mvn", "spring-boot:run"]